<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Lob</title>
</head>
<body>
  This page is flying
  <script lang="text/javascript" src="//cdn.ably.io/lib/ably.min.js" >
  </script>
  <script>
  var apiKey = "1YRBpA.Kva1OA:Wy71uGGrQ8kFl8L_"
  var realtime = new Ably.Realtime({ key: apiKey });
  var channel = realtime.channels.get('lobChannel');
  console.log("hello")

  function deviceMotionHandler(deviceMotionEvent) {
    // Fix vector to handle the fact iOS and Windows define it backwards
    var vector;
    if (navigator.userAgent.match(/Windows/i)) {
      vector = {
        x: -1 * deviceMotionEvent.accelerationIncludingGravity.x,
        y: -1 * deviceMotionEvent.accelerationIncludingGravity.y,
        z: -1 * deviceMotionEvent.accelerationIncludingGravity.z
      };
    } else if (navigator.userAgent.match(/Android/i)) {
      vector = deviceMotionEvent.accelerationIncludingGravity;
    } else {
      vector = {
        x: -1 * deviceMotionEvent.accelerationIncludingGravity.x,
        y: -1 * deviceMotionEvent.accelerationIncludingGravity.y,
        z: -1 * deviceMotionEvent.accelerationIncludingGravity.z
      };
    }
    channel.publish("myEvent", vector, function(err) {
      if(err)
        console.log('Unable to publish message; err = ' + err.message);
      else
        console.log('Message successfully sent');
    });
  }
  alert(navigator.userAgent)
  if (window.DeviceMotionEvent) {
    window.addEventListener("devicemotion", deviceMotionHandler);
  }
  </script>
</body>
</html>
