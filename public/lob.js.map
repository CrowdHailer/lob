{"version":3,"file":"lob.js","sources":["..//home/peter/Workshop14/lob/assets/scripts/logger.ts","..//home/peter/Workshop14/lob/assets/scripts/dispatcher.ts","..//home/peter/Workshop14/lob/assets/scripts/action.ts","..//home/peter/Workshop14/lob/assets/scripts/state.ts","..//home/peter/Workshop14/lob/assets/scripts/boot.ts"],"sourcesContent":["\nexport function create (prefix){\n  prefix = \"[\" + prefix + \"]\";\n  var notices = [prefix];\n  return {\n    info: function(..._){\n      var args = Array.prototype.slice.call(arguments);\n      console.info.apply(console, notices.concat(args));\n    },\n    warn: function(..._){\n      var args = Array.prototype.slice.call(arguments);\n      console.warn.apply(console, notices.concat(args));\n    },\n    error: function(..._){\n      var args = Array.prototype.slice.call(arguments);\n      console.error.apply(console, notices.concat(args));\n    }\n  };\n}\n\nexport interface Logger {\n  info: (...items) => void;\n  warn: (...items) => void;\n  error: (...items) => void;\n}\n\nexport var NullLogger = {\n  info: function(...a){ null; },\n  warn: function(...a){ null; },\n  error: function(...a){ null; }\n};\n","import { NullLogger } from \"./logger.ts\";\n\n// Raise Error for circular calls\nfunction Dispatcher(handlers, world){\n  this.dispatch = function(){\n    var args = arguments;\n    handlers.forEach(function(handler){\n      try {\n        handler.apply({}, args);\n      } catch(e) {\n        world.error(e);\n      }\n    });\n\n    if (handlers.length == 0) {\n      world.warn.apply(world, args);\n    } else {\n      world.info.apply(world, args);\n    }\n  };\n  this.register = function(handler){\n    return new Dispatcher(handlers.concat(handler), world);\n  };\n};\n\nexport function create(world=NullLogger){\n  return new Dispatcher([], world);\n};\nexport default Dispatcher;\n","import * as Dispatcher from \"./dispatcher.ts\";\nimport { Logger, NullLogger } from \"./logger.ts\";\n\n\nexport function create(filter: () => void, logger?: Logger): {(): void, register: (handler: ()=> void) => void}\nexport function create<A, B>(filter: (a: A) => B, logger?: Logger): {(a: A): void, register: (handler: (m: B)=> void) => void}\n\nexport function create(filter, logger=NullLogger){\n  var action: any;\n  var dispatcher = Dispatcher.create(logger);\n  action = function(minutiae){\n    var noDetailWithAction = arguments.length == 0;\n    try {\n      if (noDetailWithAction) {\n        dispatcher.dispatch();\n      } else {\n        dispatcher.dispatch(filter(minutiae));\n      }\n    }\n    catch (e) {\n      logger.error(e);\n    }\n  };\n  action.register = function(handler){\n    dispatcher = dispatcher.register(handler);\n  };\n  return action;\n};\n","var FREEFALL_LIMIT = 4;\n\nvar Reading = {\n  freefall: function(reading){\n    var a = reading.acceleration;\n    var magnitude = Math.sqrt(a.x * a.x + a.y * a.y + a.z * a.z);\n    return magnitude < FREEFALL_LIMIT;\n  }\n};\n\nexport var DEFAULT = {\n  currentFlightReadings: [],\n  currentReading: null,\n  flightRecords: []\n};\nexport function handleReset(_state=DEFAULT){\n  return DEFAULT;\n};\nexport function handleNewReading(reading, state=DEFAULT){\n  var flightRecords = state.flightRecords;\n  var currentFlightReadings = state.currentFlightReadings;\n\n  if (Reading.freefall(reading)){\n    currentFlightReadings = currentFlightReadings.concat(reading);\n  } else if (currentFlightReadings[0]){\n    flightRecords = flightRecords.concat([currentFlightReadings]);\n    currentFlightReadings = [];\n  }\n\n  return {\n    currentFlightReadings: currentFlightReadings,\n    currentReading: reading,\n    flightRecords: flightRecords\n  };\n};\n","console.log(\"Starting boot ...\");\n\nimport * as Action from \"./action.ts\";\nimport * as Logger from \"./logger.ts\";\n\nvar Actions = {\n  newReading: Action.create(function(a: any){ return a; }, Logger.create(\"New Reading\")),\n  reset: Action.create(function(){ null; }, Logger.create(\"Reset\")),\n  submitFlightLog: Action.create(function(){ null; }, Logger.create(\"Submit Flight log\")),\n  failedConnection: Action.create(function(reason: any){ return reason; }, Logger.create(\"Failed Connection\")),\n};\nimport * as Dispatcher from \"./dispatcher.ts\";\nimport * as State from \"./state.ts\";\n\nfunction StateStore(){\n  var state;\n  var dispatcher = Dispatcher.create();\n\n  function dispatch(store){\n    dispatcher.dispatch(store);\n  }\n\n  return {\n    reset: function(){\n      state = State.handleReset(state);\n      dispatch(this);\n    },\n    newReading: function(reading){\n      state = State.handleNewReading(reading, state);\n      dispatch(this);\n    },\n    getState: function(){\n      return state;\n    },\n    register: function(callback){\n      dispatcher = dispatcher.register(callback);\n    }\n  };\n}\n\nexport default Actions;\nexport var store = StateStore();\n"],"names":["create","Dispatcher.create","Action.create","Logger.create","State.handleReset","State.handleNewReading"],"mappings":"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"}