{"version":3,"file":"lob.js","sources":["..//home/peter/Workshop14/lob/client/framework/logger.js","..//home/peter/Workshop14/lob/client/framework/dispatcher.js","..//home/peter/Workshop14/lob/client/utils/utils.js","..//home/peter/Workshop14/lob/client/framework/event.js","..//home/peter/Workshop14/lob/client/framework/general-store.js","..//home/peter/Workshop14/lob/client/polyfill.js","..//home/peter/Workshop14/lob/client/state.js","..//home/peter/Workshop14/lob/client/store.js","..//home/peter/Workshop14/lob/client/client.js","..//home/peter/Workshop14/lob/client/boot.js"],"sourcesContent":["/* jshint esnext: true */\n\nexport function wrap(console, settings){\n  var prefix;\n  var notices = [];\n  if (settings.prefix){\n    prefix = \"[\" + settings.prefix + \"]\";\n    notices = notices.concat(prefix);\n  }\n  var argsToArray = function(args){\n    return Array.prototype.slice.call(args);\n  };\n  function debug(){\n    console.debug.apply(console, notices.concat(argsToArray(arguments)));\n  }\n  function info(){\n    console.info.apply(console, notices.concat(argsToArray(arguments)));\n  }\n  function warn(a){\n    var args = argsToArray(arguments);\n    console.warn.apply(console, notices.concat(args));\n  }\n  function error(e){\n    var args = argsToArray(arguments);\n    console.error.apply(console, notices.concat(args));\n  }\n  return {\n    debug: debug,\n    info: info,\n    warn: warn,\n    error: error,\n  };\n}\n\nexport var silent = {\n  debug: function(){  },\n  info: function(){  },\n  warn: function(){  },\n  // error logging should be used for errors and in development these should be thrown\n  error: function(e){ throw e; }\n};\n\n\nexport var DEFAULT = {\n  info: function(){  },\n  warn: function(){  },\n  // error logging should be used for errors and in development these should be thrown\n  error: function(e){ throw e; }\n};\n\nexport var NullLogger = {\n  info: function(a){  },\n  warn: function(a){  },\n  error: function(a){  },\n};\n","/* jshint esnext: true */\n\nimport { DEFAULT } from \"./logger\";\n\n// Raise Error for circular calls\nfunction Dispatcher(handlers, console){\n  this.dispatch = function(){\n    var args = arguments;\n    handlers.forEach(function(handler){\n      try {\n        handler.apply({}, args);\n      } catch(e) {\n        console.error(e);\n      }\n    });\n\n    if (handlers.length === 0) {\n      console.warn.apply(console, args);\n    } else {\n      console.info.apply(console, args);\n    }\n  };\n  this.register = function(handler){\n    return new Dispatcher(handlers.concat(handler), console);\n  };\n}\n\nexport function create(console){\n  if (console == void 0) {\n    console = DEFAULT;\n  }\n  return new Dispatcher([], console);\n}\nexport default Dispatcher;\n","/* jshint esnext: true */\n\nexport function argsToArray(args){\n  return Array.prototype.slice.call(args);\n}\n","/* jshint esnext: true */\n\nimport * as Dispatcher from \"./dispatcher\";\nimport { DEFAULT } from \"./logger\";\nimport { argsToArray } from \"../utils/utils\";\n\n\n// Simply a stateful dispatcher\n// DEBT should be start not create\nexport function start(logger){\n  if (logger == void 0) { logger = DEFAULT; }\n\n  var dispatcher = Dispatcher.create(logger);\n\n  var action = function(){\n    var args = argsToArray(arguments);\n    dispatcher.dispatch.apply({}, args);\n  };\n  action.register = function(handler){\n    dispatcher = dispatcher.register(handler);\n  };\n\n  return action;\n}\n","/* jshint esnext: true */\n\n// State will never be assigned if evolver throws error\n// - no need for rollback;\n// Handle errors in logger?\n// - if wanted then the evolver should push errors to logger\n// Advance function to return instance of store?\n// Option to instantiate store with state\nexport function GeneralStore(state, handlers){\n  var store = this;\n\n  function advance(evolver){\n    state = evolver(state);\n  }\n\n  this.advance = advance;\n\n  function wrapHandler(handler){\n    return function(){\n      var args = Array.prototype.slice.call(arguments);\n      state = handler.apply({}, [state].concat(args));\n    };\n  }\n\n  for (var name in handlers) {\n    this[name] = wrapHandler(handlers[name]);\n  }\n\n  Object.defineProperty(this, \"state\", {\n    get: function(){ return state; }\n  });\n\n}\n\nexport function enhance(handlers){\n  return {\n    start: function(state){\n      return new GeneralStore(state, handlers);\n    }\n  };\n}\n\nexport function start(state){\n  return new GeneralStore(state, {});\n}\n","if (!Object.assign) {\n  Object.defineProperty(Object, 'assign', {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function(target) {\n      'use strict';\n      if (target === undefined || target === null) {\n        throw new TypeError('Cannot convert first argument to object');\n      }\n\n      var to = Object(target);\n      for (var i = 1; i < arguments.length; i++) {\n        var nextSource = arguments[i];\n        if (nextSource === undefined || nextSource === null) {\n          continue;\n        }\n        nextSource = Object(nextSource);\n\n        var keysArray = Object.keys(nextSource);\n        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\n          var nextKey = keysArray[nextIndex];\n          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\n          if (desc !== undefined && desc.enumerable) {\n            to[nextKey] = nextSource[nextKey];\n          }\n        }\n      }\n      return to;\n    }\n  });\n}\n","/* jshint esnext: true */\nimport \"./polyfill\";\n\nfunction lens(key){\n  return function(func){\n    return function(obj){\n      obj = obj || key;\n      var update = {};\n      update[key] = func(obj[key]);\n      return Object.assign({}, obj, update);\n    };\n  };\n}\n\nvar compose = function () {\n  var fns = arguments;\n\n  return function (result) {\n    for (var i = fns.length - 1; i > -1; i--) {\n      result = fns[i].call(this, result);\n    }\n\n    return result;\n  };\n};\n\nvar FREEFALL_LIMIT = 4;\n\nvar Reading = {\n  freefall: function(reading){\n    var a = reading.acceleration;\n    var magnitude = Math.sqrt(a.x * a.x + a.y * a.y + a.z * a.z);\n    return magnitude < FREEFALL_LIMIT;\n  }\n};\n\nvar EMPTY_READINGS = Object.freeze({\n  currentFlight: [],\n  current: null,\n  flightHistory: []\n});\n\nvar readings = {\n  reset: function(_readings){\n    return EMPTY_READINGS;\n  },\n  // new: function(readings, reading){\n  //   return Object.assign({}, readings, {current: reading});\n  // }\n};\n\nexport var resetReadings = lens(\"readings\")(readings.reset);\n\nexport function newReading(state, current){\n  var readings = state.readings;\n  var currentFlight = readings.currentFlight;\n  var flightHistory = readings.flightHistory;\n  if (Reading.freefall(current)) {\n    currentFlight = currentFlight.concat(current);\n  } else if(currentFlight[0]) {\n    flightHistory = flightHistory.concat([currentFlight]);\n    currentFlight = [];\n  }\n  readings = {current: current, currentFlight: currentFlight, flightHistory: flightHistory};\n  return Object.assign({}, state, {readings: readings});\n}\n","/* jshint esnext: true */\n\nimport * as GeneralStore from \"./framework/general-store\";\nimport * as StateUpdates from \"./state\";\n\nvar Store = GeneralStore.enhance(StateUpdates);\n\nexport default Store;\n","/* jshint esnext: true */\nimport * as Event from \"./framework/event\";\nimport * as Logger from \"./framework/logger\";\nimport Store from \"./store\";\n\nfunction Client(world){\n  var logger = world.console;\n  var events = {\n    resetReadings: Event.start(Logger.wrap(logger, {prefix: \"Reset readings\"})),\n    newReading: Event.start(Logger.wrap(logger, {prefix: \"New reading\"}))\n  };\n\n  var store = Store.start();\n  events.resetReadings.register(store.resetReadings);\n  events.newReading.register(store.newReading);\n\n  this.resetReadings = function(){\n    events.resetReadings();\n  };\n  this.newReading = function(reading){\n    // Validate here\n    events.newReading(reading);\n  };\n\n  Object.defineProperty(this, \"currentReading\", {\n    get: function(){\n      return store.state.readings.current;\n    }\n  });\n\n  Object.defineProperty(this, \"currentFlight\", {\n    get: function(){\n      return store.state.readings.currentFlight;\n    }\n  });\n  Object.defineProperty(this, \"flightHistory\", {\n    get: function(){\n      return store.state.readings.flightHistory;\n    }\n  });\n  // events.resetReadings();\n}\n\nexport function start(world){\n  return new Client(world);\n}\n","/* jshint esnext: true */\n\nimport * as Client from \"./client\";\nimport * as Logger from \"./framework/logger\";\nimport { argsToArray } from \"./utils/utils\";\n\nvar logger = Object.assign({}, window.console, {error: function(e){\n  var args = argsToArray(arguments);\n  var error = args[args.length - 1];\n  console.info.apply(console, args);\n  throw error;\n}});\n\nvar client = Client.start({\n  console: Logger.wrap(logger, {prefix: \"Lob client\"})\n});\n\nexport default client;\n"],"names":["start","Dispatcher.create","GeneralStore.enhance","Event.start","Logger.wrap","Client.start"],"mappings":"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"}