{"version":3,"file":"lob.js","sources":["..//home/peter/Workshop14/lob/assets/scripts/logger.ts","..//home/peter/Workshop14/lob/assets/scripts/dispatcher.ts","..//home/peter/Workshop14/lob/assets/scripts/action.ts","..//home/peter/Workshop14/lob/client/actions.ts","..//home/peter/Workshop14/lob/client/store.ts","..//home/peter/Workshop14/lob/client/app.ts","..//home/peter/Workshop14/lob/assets/scripts/utils.ts","..//home/peter/Workshop14/lob/assets/scripts/accelerometer.ts","..//home/peter/Workshop14/lob/client/connection.ts","..//home/peter/Workshop14/lob/client/boot.ts"],"sourcesContent":["\nexport function create (prefix){\n  prefix = \"[\" + prefix + \"]\";\n  var notices = [prefix];\n  return {\n    info: function(..._){\n      var args = Array.prototype.slice.call(arguments);\n      console.info.apply(console, notices.concat(args));\n    },\n    warn: function(..._){\n      var args = Array.prototype.slice.call(arguments);\n      console.warn.apply(console, notices.concat(args));\n    },\n    // error: function(..._){\n    //   var args = Array.prototype.slice.call(arguments);\n    //   console.error.apply(console, notices.concat(args));\n    // }\n    error: function(e){ throw e; }\n  };\n}\n\nexport interface Logger {\n  info: (...items) => void;\n  warn: (...items) => void;\n  error: (...items) => void;\n}\n\nexport var DefaultLogger = {\n  info: function(...a){ null; },\n  warn: function(...a){ null; },\n  // error logging should be used for errors and in development these should be thrown\n  error: function(e){ throw e; }\n};\n\nexport var NullLogger = {\n  info: function(...a){ null; },\n  warn: function(...a){ null; },\n  error: function(...a){ null; },\n};\n","import { DefaultLogger } from \"./logger.ts\";\n\n// Raise Error for circular calls\nfunction Dispatcher(handlers, world){\n  this.dispatch = function(){\n    var args = arguments;\n    handlers.forEach(function(handler){\n      try {\n        handler.apply({}, args);\n      } catch(e) {\n        world.error(e);\n      }\n    });\n\n    if (handlers.length == 0) {\n      world.warn.apply(world, args);\n    } else {\n      world.info.apply(world, args);\n    }\n  };\n  this.register = function(handler){\n    return new Dispatcher(handlers.concat(handler), world);\n  };\n};\n\nexport function create(world=DefaultLogger){\n  return new Dispatcher([], world);\n};\nexport default Dispatcher;\n","import * as Dispatcher from \"./dispatcher.ts\";\nimport { Logger, NullLogger } from \"./logger.ts\";\n\n\nexport function create(filter: () => void, logger?: Logger): {(): void, register: (handler: ()=> void) => void}\nexport function create<A, B>(filter: (a: A) => B, logger?: Logger): {(a: A): void, register: (handler: (m: B)=> void) => void}\n\nexport function create(filter, logger=NullLogger){\n  var action: any;\n  var dispatcher = Dispatcher.create(logger);\n  action = function(minutiae){\n    var noDetailWithAction = arguments.length == 0;\n    try {\n      if (noDetailWithAction) {\n        dispatcher.dispatch();\n      } else {\n        dispatcher.dispatch(filter(minutiae));\n      }\n    }\n    catch (e) {\n      logger.error(e);\n    }\n  };\n  action.register = function(handler){\n    dispatcher = dispatcher.register(handler);\n  };\n  return action;\n};\n","import * as Action from \"../assets/scripts/action.ts\";\nimport * as Logger from \"../assets/scripts/logger.ts\";\n\nexport default {\n  newReading: Action.create(function(a: any){ return a; }, Logger.create(\"New Reading\")),\n  resetReadings: Action.create(function(){ null; }, Logger.create(\"Reset\")),\n  badReading: Action.create(function(reading: any){ return reading; }, Logger.create(\"Bad Reading\")),\n\n  uplinkAvailable: Action.create(function(){ null; }, Logger.create(\"Uplink Available\")),\n  startStreaming: Action.create(function(){ null; }, Logger.create(\"Start Streaming\")),\n  failedConnection: Action.create(function(reason: any){ return reason; }, Logger.create(\"Failed Connection\")),\n\n  closeNotice: Action.create(function(reading: any){ return reading; }, Logger.create(\"Notice Closed\")),\n};\n","\n// Abstract store\nfunction AStore(){\n  var state = {};\n  return {\n    advance: function(evolver){\n      console.log(\"advance\");\n      state = evolver(state);\n    },\n    getState: function(){\n      return state;\n    }\n  };\n};\nvar m: number;\nvar o: any;\no = Object;\nfunction newReading(state){\n  console.log(state);\n  var i = state.i || 0;\n  return o.assign({}, state, {i: i+1});\n};\n\nfunction startStreaming(state){\n  if (state.isTransmitting) { return state; }\n  return o.assign({}, state, {isTransmitting: true});\n}\n\nfunction MyStore(){\n  var myStore = this;\n  this.newReading = function(){\n    myStore.advance(newReading);\n  };\n  this.startStreaming = function(){\n    myStore.advance(startStreaming);\n  };\n}\n\n\nvar a = AStore();\nMyStore.prototype = a;\n\nexport default function(){\n  return new MyStore();\n}\n","import Store from \"./store.ts\";\n\nexport default function App(actions){\n  var services = {};\n  var components = {};\n  var store = Store();\n  actions.newReading.register(store.newReading);\n  actions.startStreaming.register(store.startStreaming);\n\n  return {\n    registerService: function(name, factory){\n      services[name] ={factory: factory};\n    },\n    getService: function(name){\n      var service = services[name];\n      if (service.instance) { return service.instance; }\n      return service.instance = service.factory(this);\n    },\n    registerComponent: function(name, factory){\n      components[name] ={factory: factory};\n    },\n    getComponent: function(name, element){\n      var component = components[name];\n      return component.factory(element, this);\n    },\n    actions: actions,\n    store: store\n  };\n}\n","// TODO currently untested\nexport function throttle(fn, threshhold, scope?) {\n  threshhold = threshhold || 250;\n  var last,\n  deferTimer;\n  return function () {\n    var context = scope || this;\n    var now = Date.now(), args = arguments;\n\n    if (last && now < last + threshhold) {\n      // hold on to it\n      clearTimeout(deferTimer);\n      deferTimer = setTimeout(function () {\n        last = now;\n        fn.apply(context, args);\n      }, threshhold);\n    } else {\n      last = now;\n      fn.apply(context, args);\n    }\n  };\n}\n\n// TODO currently untested\nexport function round (precision: number) {\n  return function (value: number) {\n    return parseFloat(value.toFixed(precision));\n  };\n}\n\n\nexport function getParameterByName(name) {\n    name = name.replace(/[\\[]/, \"\\\\[\").replace(/[\\]]/, \"\\\\]\");\n    var regex = new RegExp(\"[\\\\?&]\" + name + \"=([^&#]*)\"),\n        results = regex.exec(location.search);\n    return results === null ? \"\" : decodeURIComponent(results[1].replace(/\\+/g, \" \"));\n}\n","var DEVICEMOTION = \"devicemotion\";\nvar THROTTLE_RATE = 100; // ms\n\nimport { throttle } from \"./utils.ts\";\n\nexport default function Accelerometer(app){\n  var actions = app.actions;\n  function reportDeviceMotionEvent (deviceMotionEvent) {\n    var raw = deviceMotionEvent.accelerationIncludingGravity;\n    if (typeof raw.x === \"number\") {\n      actions.newReading({acceleration: {x: raw.x, y: raw.y, z: raw.z}, timestamp: Date.now()});\n    }\n    else {\n      actions.badReading(raw);\n    }\n  }\n\n  var throttledReport = throttle(reportDeviceMotionEvent, THROTTLE_RATE);\n\n  return {\n    start: function(){\n      window.addEventListener(DEVICEMOTION, throttledReport);\n    }\n  };\n}\n","\nexport default function(app){\n  // validate app\n  console.log(app);\n  return {\n    start: function(){\n      console.log(\"start connection\");\n      setTimeout(function(){\n        app.actions.failedConnection();\n      }, 1000);\n    },\n    publish: function(){\n      console.log(\"publishing\");\n    }\n  };\n};\n","console.log(\"starting client\");\n\nimport actions from \"./actions.ts\";\nimport App from \"./app.ts\";\nvar app = App(actions);\n\nimport Accelerometer from \"../assets/scripts/accelerometer.ts\";\napp.registerService(\"accelerometer\", Accelerometer);\nimport Connection from \"./connection.ts\";\napp.registerService(\"connection\", Connection);\n\n// import Store from \"./store.ts\";\n// app.store = Store();\n\napp.getService(\"accelerometer\").start();\nexport default app;\n\napp.registerComponent(\"uplink\", function($root, app){\n  console.log($root);\n  app.getService(\"connection\").start();\n\n  app.actions.newReading.register(function(r){\n    console.log(app.store.getState());\n    console.log(\"uplink\");\n  });\n});\n\napp.getComponent(\"uplink\", \"dummy element\");\n\n// store.newReading();\n// store.newReading();\n\n// store.newReading();\napp.actions.startStreaming();\napp.actions.newReading();\n"],"names":["create","Dispatcher.create","Action.create","Logger.create","default_1","Store","Connection"],"mappings":"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"}