{"version":3,"file":"flyer.js","sources":["..//home/peter/Workshop14/lob/client/polyfill.js","..//home/peter/Workshop14/lob/client/flyer/state.js","..//home/peter/Workshop14/lob/client/flyer/flyer.js","..//home/peter/Workshop14/lob/client/flyer.js"],"sourcesContent":["if (!Object.assign) {\n  Object.defineProperty(Object, 'assign', {\n    enumerable: false,\n    configurable: true,\n    writable: true,\n    value: function(target) {\n      'use strict';\n      if (target === undefined || target === null) {\n        throw new TypeError('Cannot convert first argument to object');\n      }\n\n      var to = Object(target);\n      for (var i = 1; i < arguments.length; i++) {\n        var nextSource = arguments[i];\n        if (nextSource === undefined || nextSource === null) {\n          continue;\n        }\n        nextSource = Object(nextSource);\n\n        var keysArray = Object.keys(nextSource);\n        for (var nextIndex = 0, len = keysArray.length; nextIndex < len; nextIndex++) {\n          var nextKey = keysArray[nextIndex];\n          var desc = Object.getOwnPropertyDescriptor(nextSource, nextKey);\n          if (desc !== undefined && desc.enumerable) {\n            to[nextKey] = nextSource[nextKey];\n          }\n        }\n      }\n      return to;\n    }\n  });\n}\n","/* jshint esnext: true */\n// TODO handle polyfill\nimport \"../polyfill\";\n\nfunction lens(key){\n  return function(func){\n    return function(obj){\n      obj = obj || key;\n      var update = {};\n      update[key] = func(obj[key]);\n      return Object.assign({}, obj, update);\n    };\n  };\n}\n\nvar compose = function () {\n  var fns = arguments;\n\n  return function (result) {\n    for (var i = fns.length - 1; i > -1; i--) {\n      result = fns[i].call(this, result);\n    }\n\n    return result;\n  };\n};\n\nvar FREEFALL_LIMIT = 4;\n\nvar Reading = {\n  freefall: function(reading){\n    var a = reading.acceleration;\n    var magnitude = Math.sqrt(a.x * a.x + a.y * a.y + a.z * a.z);\n    return magnitude < FREEFALL_LIMIT;\n  }\n};\n\nvar EMPTY_READINGS = Object.freeze({\n  currentFlight: [],\n  current: null,\n  flightHistory: []\n});\n\nvar readings = {\n  reset: function(_readings){\n    return EMPTY_READINGS;\n  },\n  // new: function(readings, reading){\n  //   return Object.assign({}, readings, {current: reading});\n  // }\n};\n\nexport var resetReadings = lens(\"readings\")(readings.reset);\n\nexport function newReading(state, current){\n  state = state || {};\n  var readings = state.readings || EMPTY_READINGS;\n  var currentFlight = readings.currentFlight;\n  var flightHistory = readings.flightHistory;\n  if (Reading.freefall(current)) {\n    currentFlight = currentFlight.concat(current);\n  } else if(currentFlight[0]) {\n    flightHistory = flightHistory.concat([currentFlight]);\n    currentFlight = [];\n  }\n  readings = {current: current, currentFlight: currentFlight, flightHistory: flightHistory};\n  return Object.assign({}, state, {readings: readings});\n}\n\nexport function badReading(state){\n  var MESSAGE = \"Could not read the data from this device. Please try again on a mobile with working accelerometer.\";\n  return showAlert(state, MESSAGE);\n}\nexport function showAlert(state, message){\n  state = state || {};\n  var notices = state.notices || [];\n  notices = notices.concat(message);\n  return Object.assign({}, state, {notices: notices});\n}\n\nexport function closeNotices(state){\n  state = state || {};\n  var notices = [];\n  return Object.assign({}, state, {notices: notices});\n}\n\nexport function uplinkAvailable(state){\n  state = state || {};\n  var uplink = state.uplink || {};\n  return Object.assign({}, state, {uplink: {status: \"AVAILABLE\"}});\n}\nexport function startTransmitting(state){\n  state = state || {};\n  var uplink = state.uplink || {};\n  return Object.assign({}, state, {uplink: {status: \"TRANSMITTING\"}});\n}\nexport function uplinkFailed(state){\n  state = state || {};\n  var uplink = state.uplink || {};\n  return Object.assign({}, state, {uplink: {status: \"FAILED\"}});\n}\n","/* jshint esnext: true */\n\nimport * as State from \"./state\";\n\nexport default function Flyer(world){\n  if ( !(this instanceof Flyer) ) { return new Flyer(world); }\n  var flyer = this;\n\n  var state;\n  function logInfo() {\n    flyer.logger.info.apply(flyer.logger, arguments);\n  }\n\n  this.resetReadings = function(){\n    state = State.resetReadings(state);\n    logInfo(\"[Reset readings]\");\n  };\n  this.newReading = function(reading){\n    state = State.newReading(state, reading);\n    logInfo(\"[New reading]\", reading);\n  };\n\n  // DEBT these properties belong on a projection\n  Object.defineProperty(this, \"currentReading\", {\n    get: function(){\n      var readings = state.readings || {};\n      return readings.current;\n    }\n  });\n  Object.defineProperty(this, \"currentFlight\", {\n    get: function(){\n      var readings = state.readings || {};\n      return readings.currentFlight || [];\n    }\n  });\n  Object.defineProperty(this, \"flightHistory\", {\n    get: function(){\n      var readings = state.readings || {};\n      return readings.flightHistory || [];\n    }\n  });\n}\n","/* jshint esnext: true */\nimport Flyer from \"./flyer/flyer\";\n\nvar flyer = new Flyer();\nflyer.logger = window.console;\n\nvar DEVICEMOTION = \"devicemotion\";\nfunction AccelerometerController(global, flyer){\n  global.addEventListener(DEVICEMOTION, function(deviceMotionEvent){\n    console.debug(\"AccelerometerController\", deviceMotionEvent);\n    flyer.newReading({\n      acceleration: deviceMotionEvent.accelerationIncludingGravity,\n      timestamp: Date.now()\n    });\n  });\n}\n\nvar accelerometerController = new AccelerometerController(window, flyer);\n"],"names":["State.resetReadings","State.newReading"],"mappings":"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"}