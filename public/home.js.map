{"version":3,"file":"home.js","sources":["..//Users/mattheworiordan/Projects/Ably/demos/lob/client/config.js","..//Users/mattheworiordan/Projects/Ably/demos/lob/client/home.js"],"sourcesContent":["export var Config = {\n  readingPublishLimit: 200, // ms\n  flightPublishLimit: 1000, // ms\n  trackingGraphTimePeriod: 8000, // ms - time to keep points in visible graph\n  gravityMagnitudeConstant: 10, // default gravity magnitude value from accelerometer\n  broadcastNewChannelName: 'broadcast:channel' /* replicated in app.rb */\n};\n","import { Config } from './config';\n\n$(function() {\n  var $mobileSupported = $('.mobile-ready'),\n      $mobileNotSupported = $('.mobile-not-ready'),\n      $channelName = $(this).find('input[name=channel-name]');\n\n  var gn = new GyroNorm();\n  gn.init().then(function() {\n    if (gn.isAvailable(GyroNorm.DEVICE_ORIENTATION) || gn.isAvailable(GyroNorm.ACCELERATION_INCLUDING_GRAVITY)) {\n      $mobileSupported.show();\n      $mobileNotSupported.hide();\n    }\n  });\n\n  $('form.track-flight').on('submit', function(event) {\n    if ($channelName.val().replace(/^\\s+|\\s+$/g,\"\").length === 0) {\n      event.preventDefault();\n      $(this).find('input[name=channel-name]').focus();\n      alert(\"Please enter a valid live Lob code from another device\");\n    }\n  });\n\n  var ably = new Ably.Realtime({ authUrl: '/token' }),\n      broadcastChannel = ably.channels.get(Config.broadcastNewChannelName),\n      $recentLobs = $('div.recent-lobs'),\n      $lobHistory = $('ul.lob-history'),\n      recentChannels = {}\n\n  function pruneAndPresentChannelData() {\n    var activeChannelMessages = [],\n        activeChannelIDs = {},\n        $channelList = $('<ul>');\n\n    for (var channel in recentChannels) {\n      activeChannelMessages.push(recentChannels[channel])\n    }\n\n    activeChannelMessages.\n      sort(function(a, b) { return b.timestamp - a.timestamp; }).\n      slice(0,15).\n      forEach(function(message) {\n        activeChannelIDs[message.data.channel] = true;\n        var link = $('<a>').text(message.data.channel).attr('href', '/track/' + message.data.channel);\n        $channelList.append($(\"<li>\").append(link));\n      });\n\n    for (var channel in recentChannels) {\n      if (!activeChannelIDs[channel]) {\n        delete recentChannels[channel];\n      }\n    }\n\n    $lobHistory.find('li').remove();\n    $lobHistory.append($channelList.find('li'));\n    $recentLobs.show();\n  }\n\n  broadcastChannel.attach(function(err) {\n    if (err) {\n      console.error(\"Could not attach to broadcast channel\", err);\n      return;\n    }\n\n    broadcastChannel.subscribe(\"new\", function(message) {\n      recentChannels[message.data.channel] = message;\n      pruneAndPresentChannelData();\n    });\n\n    broadcastChannel.history(function(err, historyPage) {\n      if (err) {\n        console.warn(\"Could not retrieve broadcast history:\", err);\n        return;\n      }\n      historyPage.items.forEach(function(message) {\n        recentChannels[message.data.channel] = message;\n      });\n      pruneAndPresentChannelData();\n    });\n  });\n});\n"],"names":[],"mappings":"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"}